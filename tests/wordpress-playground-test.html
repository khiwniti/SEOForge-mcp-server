<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEO Forge WordPress Playground Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f1;
            line-height: 1.6;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        .header p {
            margin: 10px 0 0;
            opacity: 0.9;
            font-size: 1.1em;
        }
        .content {
            padding: 30px;
        }
        .test-button {
            display: inline-block;
            background: #2563eb;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 18px;
            margin: 10px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        .test-button:hover {
            background: #1d4ed8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }
        .test-button.secondary {
            background: #64748b;
        }
        .test-button.secondary:hover {
            background: #475569;
        }
        .instructions {
            background: #f0f8ff;
            border: 1px solid #0288d1;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin: 0 0 15px;
            color: #01579b;
        }
        .instructions ol {
            margin: 0;
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 10px;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }
        .feature h4 {
            margin: 0 0 10px;
            color: #1e293b;
        }
        .feature p {
            margin: 0;
            color: #64748b;
            font-size: 14px;
        }
        .playground-frame {
            width: 100%;
            height: 800px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
        }
        .alert {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 15px;
            margin: 20px 0;
            color: #92400e;
        }
        .alert h4 {
            margin: 0 0 10px;
            color: #92400e;
        }
        @media (max-width: 768px) {
            .features {
                grid-template-columns: 1fr;
            }
            .header {
                padding: 20px;
            }
            .header h1 {
                font-size: 2em;
            }
            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ SEO Forge WordPress Test</h1>
            <p>Test the SEO Forge plugin with your MCP server in WordPress Playground</p>
        </div>

        <div class="content">
            <div class="alert">
                <h4>‚ö° Live API Testing</h4>
                <p>This test will connect to your actual MCP server at <strong>https://seoforge-mcp-platform.vercel.app</strong> to generate real content and images. Make sure your server is running!</p>
            </div>

            <div style="text-align: center; margin: 30px 0;">
                <button onclick="launchPlaygroundTest()" class="test-button">
                    üéÆ Launch WordPress Playground Test
                </button>
                <a href="https://playground.wordpress.net/" target="_blank" class="test-button secondary">
                    üåê Manual WordPress Playground
                </a>
            </div>

            <div class="instructions">
                <h3>üß™ Testing Steps</h3>
                <ol>
                    <li><strong>Launch Test:</strong> Click the button above to start WordPress with SEO Forge pre-installed</li>
                    <li><strong>Go to Dashboard:</strong> You'll be taken directly to the SEO Forge dashboard</li>
                    <li><strong>Test API Connection:</strong> Click "Test Connection" to verify your MCP server is working</li>
                    <li><strong>Create New Post:</strong> Go to Posts ‚Üí Add New to create a blog post</li>
                    <li><strong>Use Content Generator:</strong> In the sidebar, find "SEO Forge - Content Generator"</li>
                    <li><strong>Enter Keywords:</strong> Try "WordPress SEO optimization" or "AI content generation"</li>
                    <li><strong>Generate Content:</strong> Click "Generate Content" to create AI-powered blog content</li>
                    <li><strong>Generate Image:</strong> Click "Generate Image" to create a featured image</li>
                    <li><strong>Use Content:</strong> Click "Use This Content" to insert it into your post</li>
                    <li><strong>Publish & Test:</strong> Publish the post and check the frontend for SEO meta tags</li>
                </ol>
            </div>

            <div class="features">
                <div class="feature">
                    <h4>ü§ñ AI Content Generation</h4>
                    <p>Test real AI-powered content generation with your keywords and industry settings</p>
                </div>
                <div class="feature">
                    <h4>üé® Image Generation</h4>
                    <p>Generate custom images using AI that match your content perfectly</p>
                </div>
                <div class="feature">
                    <h4>üìä SEO Meta Tags</h4>
                    <p>Automatic SEO meta tags, Open Graph, and Twitter Card generation</p>
                </div>
                <div class="feature">
                    <h4>üåê Multi-language</h4>
                    <p>Test content generation in English, Thai, Spanish, and French</p>
                </div>
            </div>

            <div id="playground-container" style="display: none;">
                <h3>WordPress Playground - SEO Forge Test Environment</h3>
                <iframe id="playground-frame" class="playground-frame" src="about:blank"></iframe>
            </div>

            <div class="instructions">
                <h3>üîß What to Test</h3>
                <ul>
                    <li><strong>Content Quality:</strong> Check if generated content is relevant and well-structured</li>
                    <li><strong>Image Relevance:</strong> Verify that generated images match your keywords</li>
                    <li><strong>SEO Integration:</strong> Ensure meta tags are properly added to the frontend</li>
                    <li><strong>Error Handling:</strong> Test with invalid keywords or network issues</li>
                    <li><strong>Multi-language:</strong> Try generating content in different languages</li>
                    <li><strong>Different Industries:</strong> Test various industry settings</li>
                    <li><strong>Content Types:</strong> Try blog posts, product descriptions, etc.</li>
                </ul>
            </div>

            <div class="alert">
                <h4>üêõ Troubleshooting</h4>
                <p><strong>If content generation fails:</strong></p>
                <ul style="margin: 10px 0 0 20px;">
                    <li>Check that your MCP server is running and accessible</li>
                    <li>Verify the API endpoint is correct</li>
                    <li>Check browser console for JavaScript errors</li>
                    <li>Try with simpler keywords first</li>
                    <li>Ensure your server supports CORS for WordPress Playground</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        function launchPlaygroundTest() {
            const container = document.getElementById('playground-container');
            const frame = document.getElementById('playground-frame');
            
            // Show the playground container
            container.style.display = 'block';
            
            // Scroll to the playground
            container.scrollIntoView({ behavior: 'smooth' });
            
            // Create the WordPress Playground URL with our plugin
            const blueprintData = {
                "landingPage": "/wp-admin/admin.php?page=seo-forge",
                "preferredVersions": {
                    "php": "8.0",
                    "wp": "latest"
                },
                "phpExtensionBundles": ["kitchen-sink"],
                "features": {
                    "networking": true
                },
                "steps": [
                    {
                        "step": "login",
                        "username": "admin",
                        "password": "password"
                    },
                    {
                        "step": "mkdir",
                        "path": "/wordpress/wp-content/plugins/seo-forge-test"
                    },
                    {
                        "step": "writeFile",
                        "path": "/wordpress/wp-content/plugins/seo-forge-test/seo-forge-test.php",
                        "data": getPluginCode()
                    },
                    {
                        "step": "activatePlugin",
                        "pluginPath": "seo-forge-test/seo-forge-test.php"
                    }
                ]
            };
            
            // Encode the blueprint
            const encodedBlueprint = encodeURIComponent(JSON.stringify(blueprintData));
            
            // Load the playground
            const playgroundUrl = `https://playground.wordpress.net/?mode=seamless&blueprint=${encodedBlueprint}`;
            frame.src = playgroundUrl;
        }

        function getPluginCode() {
            return `<?php
/**
 * Plugin Name: SEO Forge - Playground Test
 * Description: SEO Forge plugin for WordPress Playground testing with MCP server integration
 * Version: 1.0.0
 * Author: SEO Forge Team
 */

defined('ABSPATH') || exit;

class SEOForgePlaygroundTest {
    private $api_url = 'https://seoforge-mcp-platform.vercel.app';
    
    public function __construct() {
        add_action('admin_menu', [$this, 'add_admin_menu']);
        add_action('wp_ajax_seoforge_generate_content', [$this, 'ajax_generate_content']);
        add_action('wp_ajax_seoforge_generate_image', [$this, 'ajax_generate_image']);
        add_action('add_meta_boxes', [$this, 'add_meta_boxes']);
    }
    
    public function add_admin_menu() {
        add_menu_page('SEO Forge', 'SEO Forge', 'manage_options', 'seo-forge', [$this, 'dashboard_page'], 'dashicons-chart-line', 30);
    }
    
    public function add_meta_boxes() {
        add_meta_box('seoforge-generator', 'SEO Forge - Content Generator', [$this, 'meta_box'], ['post', 'page'], 'side', 'high');
    }
    
    public function meta_box($post) {
        wp_nonce_field('seoforge_meta_box', 'seoforge_nonce');
        echo '<div style="padding: 10px 0;">
            <label><strong>Keywords:</strong></label>
            <input type="text" id="seoforge-keywords" placeholder="WordPress SEO, content optimization" style="width: 100%; margin: 5px 0;">
            <label><strong>Language:</strong></label>
            <select id="seoforge-language" style="width: 100%; margin: 5px 0;">
                <option value="en">English</option>
                <option value="th">Thai</option>
                <option value="es">Spanish</option>
                <option value="fr">French</option>
            </select>
            <div style="margin: 10px 0;">
                <button type="button" id="generate-content" class="button button-primary">Generate Content</button>
                <button type="button" id="generate-image" class="button">Generate Image</button>
            </div>
            <div id="loading" style="display: none; color: #666;">ü§ñ Generating with AI...</div>
            <div id="result" style="display: none; margin-top: 10px;">
                <h4>Generated Content:</h4>
                <div id="content" style="background: #f9f9f9; padding: 10px; border-radius: 4px; max-height: 150px; overflow-y: auto;"></div>
                <button type="button" id="use-content" class="button button-primary" style="margin-top: 5px;">Use Content</button>
            </div>
            <div id="image-result" style="display: none; margin-top: 10px;">
                <h4>Generated Image:</h4>
                <div id="image" style="text-align: center;"></div>
            </div>
        </div>
        <script>
        jQuery(document).ready(function($) {
            $("#generate-content").click(function() {
                var keywords = $("#seoforge-keywords").val();
                if (!keywords) { alert("Please enter keywords!"); return; }
                
                $("#loading").show();
                $(this).prop("disabled", true);
                
                $.post(ajaxurl, {
                    action: "seoforge_generate_content",
                    nonce: $("#seoforge_nonce").val(),
                    keywords: keywords,
                    language: $("#seoforge-language").val()
                }, function(response) {
                    $("#loading").hide();
                    $("#generate-content").prop("disabled", false);
                    if (response.success) {
                        $("#content").html(response.data.content || response.data);
                        $("#result").show();
                        if (response.data.title) $("#title").val(response.data.title);
                    } else {
                        alert("Error: " + (response.data || "Failed to generate"));
                    }
                }).fail(function() {
                    $("#loading").hide();
                    $("#generate-content").prop("disabled", false);
                    alert("Network error. Check your MCP server.");
                });
            });
            
            $("#generate-image").click(function() {
                var keywords = $("#seoforge-keywords").val();
                if (!keywords) { alert("Please enter keywords!"); return; }
                
                $(this).prop("disabled", true).text("Generating...");
                
                $.post(ajaxurl, {
                    action: "seoforge_generate_image",
                    nonce: $("#seoforge_nonce").val(),
                    prompt: "Professional image: " + keywords
                }, function(response) {
                    $("#generate-image").prop("disabled", false).text("Generate Image");
                    if (response.success && response.data.url) {
                        $("#image").html("<img src=\\"" + response.data.url + "\\" style=\\"max-width: 100%; border-radius: 4px;\\">");
                        $("#image-result").show();
                    } else {
                        alert("Image generation failed: " + (response.data || "Unknown error"));
                    }
                }).fail(function() {
                    $("#generate-image").prop("disabled", false).text("Generate Image");
                    alert("Network error. Check your MCP server.");
                });
            });
            
            $("#use-content").click(function() {
                var content = $("#content").html();
                if (typeof tinymce !== "undefined" && tinymce.get("content")) {
                    tinymce.get("content").setContent(content);
                } else {
                    $("#content").val(content);
                }
                alert("Content inserted!");
            });
        });
        </script>';
    }
    
    public function ajax_generate_content() {
        check_ajax_referer('seoforge_meta_box', 'nonce');
        
        $keywords = sanitize_text_field($_POST['keywords'] ?? '');
        $language = sanitize_text_field($_POST['language'] ?? 'en');
        
        if (empty($keywords)) {
            wp_send_json_error('Keywords required');
        }
        
        $data = [
            'action' => 'generate_content',
            'data' => [
                'keywords' => $keywords,
                'language' => $language,
                'type' => 'blog_post',
                'tone' => 'professional',
                'length' => 'medium'
            ]
        ];
        
        $response = $this->make_api_request($data);
        
        if (is_wp_error($response)) {
            wp_send_json_error($response->get_error_message());
        }
        
        wp_send_json_success($response);
    }
    
    public function ajax_generate_image() {
        check_ajax_referer('seoforge_meta_box', 'nonce');
        
        $prompt = sanitize_text_field($_POST['prompt'] ?? '');
        
        if (empty($prompt)) {
            wp_send_json_error('Prompt required');
        }
        
        $data = [
            'action' => 'generate_image',
            'data' => [
                'prompt' => $prompt,
                'style' => 'realistic',
                'size' => '1024x1024'
            ]
        ];
        
        $response = $this->make_api_request($data);
        
        if (is_wp_error($response)) {
            wp_send_json_error($response->get_error_message());
        }
        
        wp_send_json_success($response);
    }
    
    private function make_api_request($data) {
        $url = $this->api_url . '/wordpress/plugin';
        
        $response = wp_remote_post($url, [
            'headers' => ['Content-Type' => 'application/json'],
            'body' => wp_json_encode($data),
            'timeout' => 30
        ]);
        
        if (is_wp_error($response)) {
            return $response;
        }
        
        $code = wp_remote_retrieve_response_code($response);
        $body = wp_remote_retrieve_body($response);
        
        if ($code !== 200) {
            return new WP_Error('api_error', "API error: $code - $body");
        }
        
        $decoded = json_decode($body, true);
        
        if (json_last_error() !== JSON_ERROR_NONE) {
            return new WP_Error('json_error', 'Invalid JSON response');
        }
        
        return $decoded;
    }
    
    public function dashboard_page() {
        echo '<div class="wrap">
            <h1>SEO Forge Dashboard</h1>
            <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                <h2>üöÄ Welcome to SEO Forge!</h2>
                <p>Universal SEO WordPress Plugin with AI-powered content generation.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
                        <h3>üìù Create New Post</h3>
                        <p>Create a new post with SEO Forge content generation.</p>
                        <a href="' . admin_url('post-new.php') . '" class="button button-primary">New Post</a>
                    </div>
                    <div style="border: 1px solid #ddd; padding: 20px; border-radius: 8px;">
                        <h3>‚öôÔ∏è API Status</h3>
                        <p><strong>Server:</strong> ' . esc_html($this->api_url) . '</p>
                        <button type="button" id="test-api" class="button">Test Connection</button>
                    </div>
                </div>
                <div style="background: #f0f8ff; border: 1px solid #0288d1; border-radius: 6px; padding: 15px; margin: 20px 0;">
                    <h3 style="margin: 0 0 10px; color: #01579b;">üß™ Testing Instructions</h3>
                    <ol style="margin: 0; color: #01579b;">
                        <li>Click <strong>"New Post"</strong> above</li>
                        <li>Find <strong>"SEO Forge - Content Generator"</strong> in the sidebar</li>
                        <li>Enter keywords like <strong>"WordPress SEO optimization"</strong></li>
                        <li>Click <strong>"Generate Content"</strong> and <strong>"Generate Image"</strong></li>
                        <li>Use the generated content in your post</li>
                        <li>Publish and check the frontend for SEO meta tags</li>
                    </ol>
                </div>
            </div>
        </div>
        <script>
        jQuery(document).ready(function($) {
            $("#test-api").click(function() {
                $(this).prop("disabled", true).text("Testing...");
                $.post(ajaxurl, {
                    action: "seoforge_generate_content",
                    nonce: "' . wp_create_nonce('seoforge_meta_box') . '",
                    keywords: "test connection"
                }, function(response) {
                    $("#test-api").prop("disabled", false).text("Test Connection");
                    if (response.success) {
                        alert("‚úÖ API Connection Successful!\\n\\nYour MCP server is working correctly.");
                    } else {
                        alert("‚ùå API Connection Failed:\\n\\n" + (response.data || "Unknown error"));
                    }
                }).fail(function() {
                    $("#test-api").prop("disabled", false).text("Test Connection");
                    alert("‚ùå Network Error:\\n\\nCould not connect to MCP server.");
                });
            });
        });
        </script>';
    }
}

new SEOForgePlaygroundTest();
?>`;
        }
    </script>
</body>
</html>